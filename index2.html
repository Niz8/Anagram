<!DOCTYPE html>

<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anagram Solver</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f4f2ed;
    --bg2: #eceae3;
    --surface: #ffffff;
    --border: #d8d4c8;
    --border-focus: #7a9e7e;
    --accent: #5a8a5e;
    --accent-light: #e8f0e8;
    --text: #1a1a18;
    --muted: #7a7870;
    --muted2: #b0aca0;
    --red: #c0504a;
    --toggle-bg: #c8c4ba;
    --shadow: 0 2px 14px rgba(0,0,0,0.07);
  }

[data-theme=“dark”] {
–bg: #161819;
–bg2: #1e2124;
–surface: #23272c;
–border: #363c44;
–border-focus: #6aaa6e;
–accent: #7aba7e;
–accent-light: #1c2e1e;
–text: #e8e6e0;
–muted: #888078;
–muted2: #5a5850;
–red: #e06060;
–toggle-bg: #3a3e44;
–shadow: 0 2px 20px rgba(0,0,0,0.35);
}

- { box-sizing: border-box; margin: 0; padding: 0; }

html {
background: var(–bg);
transition: background 0.3s;
}

body {
background: var(–bg);
color: var(–text);
font-family: ‘DM Mono’, monospace;
min-height: 100vh;
display: flex;
flex-direction: column;
align-items: center;
padding: 40px 20px 100px;
transition: background 0.3s, color 0.3s;
}

.topbar {
width: 100%;
max-width: 620px;
display: flex;
justify-content: flex-end;
margin-bottom: 28px;
}

.theme-btn {
background: var(–surface);
border: 1px solid var(–border);
border-radius: 20px;
padding: 6px 14px 6px 10px;
display: flex;
align-items: center;
gap: 7px;
cursor: pointer;
font-family: ‘DM Mono’, monospace;
font-size: 0.7rem;
color: var(–muted);
letter-spacing: 0.06em;
transition: border-color 0.2s, color 0.2s, background 0.3s;
}
.theme-btn:hover { border-color: var(–accent); color: var(–accent); }

header {
text-align: center;
margin-bottom: 36px;
}

.logo-tiles {
display: inline-flex;
gap: 5px;
margin-bottom: 14px;
}

.tile {
width: 44px;
height: 50px;
border-radius: 6px;
background: var(–surface);
border: 2px solid var(–border);
display: flex;
align-items: center;
justify-content: center;
font-family: ‘Playfair Display’, serif;
font-weight: 900;
font-size: 1.35rem;
color: var(–text);
box-shadow: 0 3px 0 var(–border);
transition: background 0.3s, border-color 0.3s, color 0.3s, box-shadow 0.3s;
animation: tileIn 0.4s ease backwards;
}

.tile.accent {
background: var(–accent);
border-color: var(–accent);
color: #fff;
box-shadow: 0 3px 0 var(–accent-dim, #3d6b41);
}

[data-theme=“dark”] .tile.accent {
box-shadow: 0 3px 0 #4a7a4e;
}

@keyframes tileIn {
from { opacity: 0; transform: translateY(-10px) rotateX(30deg); }
to   { opacity: 1; transform: none; }
}
.tile:nth-child(1) { animation-delay: 0ms; }
.tile:nth-child(2) { animation-delay: 60ms; }
.tile:nth-child(3) { animation-delay: 120ms; }
.tile:nth-child(4) { animation-delay: 180ms; }
.tile:nth-child(5) { animation-delay: 240ms; }
.tile:nth-child(6) { animation-delay: 300ms; }
.tile:nth-child(7) { animation-delay: 360ms; }

header p {
color: var(–muted);
font-size: 0.72rem;
margin-top: 4px;
letter-spacing: 0.2em;
text-transform: uppercase;
}

.card {
background: var(–surface);
border: 1px solid var(–border);
border-radius: 18px;
padding: 30px;
width: 100%;
max-width: 620px;
box-shadow: var(–shadow);
transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
}

.field-label {
font-size: 0.65rem;
letter-spacing: 0.18em;
text-transform: uppercase;
color: var(–muted);
margin-bottom: 8px;
display: flex;
align-items: center;
gap: 8px;
}

.hint-badge {
background: var(–accent-light);
border: 1px solid var(–border);
border-radius: 4px;
padding: 1px 7px;
font-size: 0.6rem;
color: var(–accent);
letter-spacing: 0.04em;
text-transform: none;
transition: background 0.3s;
}

.main-input {
width: 100%;
background: var(–bg2);
border: 2px solid var(–border);
border-radius: 12px;
color: var(–text);
font-family: ‘Playfair Display’, serif;
font-size: 2rem;
font-weight: 700;
letter-spacing: 0.2em;
padding: 14px 20px;
text-transform: uppercase;
outline: none;
transition: border-color 0.2s, background 0.3s;
caret-color: var(–accent);
margin-bottom: 10px;
}
.main-input:focus { border-color: var(–border-focus); background: var(–surface); }
.main-input::placeholder { color: var(–muted2); font-size: 1.3rem; letter-spacing: 0.1em; }

.wildcard-row {
display: flex;
align-items: center;
gap: 10px;
margin-bottom: 24px;
}

.wildcard-note {
font-size: 0.67rem;
color: var(–muted2);
line-height: 1.5;
flex: 1;
}
.wildcard-note strong { color: var(–accent); font-weight: 500; }

.wc-dots {
display: flex;
gap: 5px;
flex-shrink: 0;
}
.wc-dot {
width: 10px; height: 10px;
border-radius: 50%;
border: 1.5px solid var(–border);
background: transparent;
transition: background 0.2s, border-color 0.2s;
}
.wc-dot.used { background: var(–accent); border-color: var(–accent); }

/* Advanced toggle */
.advanced-toggle {
display: flex;
align-items: center;
gap: 10px;
cursor: pointer;
user-select: none;
width: fit-content;
}
.advanced-toggle input { display: none; }

.toggle-track {
width: 38px; height: 22px;
background: var(–toggle-bg);
border-radius: 11px;
position: relative;
transition: background 0.25s;
flex-shrink: 0;
}
.toggle-track::after {
content: ‘’;
position: absolute;
top: 3px; left: 3px;
width: 16px; height: 16px;
background: var(–surface);
border-radius: 50%;
transition: transform 0.25s;
box-shadow: 0 1px 4px rgba(0,0,0,0.25);
}
.advanced-toggle input:checked + .toggle-track { background: var(–accent); }
.advanced-toggle input:checked + .toggle-track::after { transform: translateX(16px); }

.toggle-label {
font-size: 0.7rem;
letter-spacing: 0.12em;
text-transform: uppercase;
color: var(–muted);
}

.advanced-panel {
overflow: hidden;
max-height: 0;
opacity: 0;
margin-top: 0;
transition: max-height 0.38s ease, opacity 0.3s ease, margin-top 0.3s ease;
}
.advanced-panel.open { max-height: 280px; opacity: 1; margin-top: 20px; }

.adv-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 14px;
}
.adv-field { display: flex; flex-direction: column; }
.adv-field.full { grid-column: span 2; }

.adv-input {
width: 100%;
background: var(–bg2);
border: 1.5px solid var(–border);
border-radius: 9px;
color: var(–text);
font-family: ‘DM Mono’, monospace;
font-size: 0.9rem;
letter-spacing: 0.12em;
padding: 10px 14px;
text-transform: uppercase;
outline: none;
transition: border-color 0.2s, background 0.3s;
caret-color: var(–accent);
}
.adv-input:focus { border-color: var(–border-focus); background: var(–surface); }
.adv-input::placeholder { color: var(–muted2); text-transform: none; font-size: 0.75rem; letter-spacing: 0.04em; }

.divider { border: none; border-top: 1px solid var(–border); margin: 24px 0; }

.solve-btn {
width: 100%;
background: var(–accent);
color: #fff;
border: none;
border-radius: 11px;
font-family: ‘DM Mono’, monospace;
font-size: 0.82rem;
letter-spacing: 0.2em;
text-transform: uppercase;
padding: 15px;
cursor: pointer;
transition: opacity 0.2s, transform 0.15s, background 0.3s;
}
.solve-btn:hover { opacity: 0.85; transform: translateY(-1px); }
.solve-btn:active { transform: translateY(0); }

/* Results */
#results-wrap { width: 100%; max-width: 620px; margin-top: 22px; }

.results-header {
display: flex;
align-items: baseline;
justify-content: space-between;
margin-bottom: 14px;
padding: 0 2px;
}
.results-title {
font-size: 0.65rem;
letter-spacing: 0.18em;
text-transform: uppercase;
color: var(–muted);
}
.results-count { font-size: 0.7rem; color: var(–accent); }

.length-group { width: 100%; margin-bottom: 16px; }
.length-label {
font-size: 0.6rem;
letter-spacing: 0.15em;
text-transform: uppercase;
color: var(–muted2);
margin-bottom: 7px;
}
.chips-row { display: flex; flex-wrap: wrap; gap: 7px; }

.word-chip {
background: var(–surface);
border: 1.5px solid var(–border);
border-radius: 8px;
padding: 5px 13px;
font-family: ‘DM Mono’, monospace;
font-size: 0.8rem;
letter-spacing: 0.08em;
text-transform: uppercase;
color: var(–text);
cursor: default;
transition: border-color 0.15s, color 0.15s, background 0.15s;
animation: chipIn 0.22s ease backwards;
}
.word-chip:hover { border-color: var(–accent); color: var(–accent); background: var(–accent-light); }

@keyframes chipIn {
from { opacity: 0; transform: translateY(4px) scale(0.95); }
to   { opacity: 1; transform: none; }
}

.no-results {
color: var(–muted);
font-size: 0.8rem;
padding: 28px 0;
text-align: center;
border-top: 1px solid var(–border);
}

.loading {
display: flex;
align-items: center;
gap: 10px;
color: var(–muted);
font-size: 0.78rem;
padding: 24px 0;
}
.spinner {
width: 16px; height: 16px;
border: 2px solid var(–border);
border-top-color: var(–accent);
border-radius: 50%;
animation: spin 0.6s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.error-msg { color: var(–red); font-size: 0.78rem; padding: 16px 0; }

.disclaimer {
width: 100%;
max-width: 620px;
margin-top: 48px;
padding-top: 20px;
border-top: 1px solid var(–border);
font-size: 0.62rem;
color: var(–muted2);
letter-spacing: 0.06em;
line-height: 1.7;
text-align: center;
}

.disclaimer strong {
color: var(–muted);
font-weight: 500;
}
</style>

</head>
<body>

<div class="topbar">
  <button class="theme-btn" id="theme-btn" onclick="toggleTheme()">
    <span id="theme-icon">☽</span>
    <span id="theme-label">Dark mode</span>
  </button>
</div>

<header>
  <div class="logo-tiles">
    <div class="tile">A</div>
    <div class="tile">N</div>
    <div class="tile accent">A</div>
    <div class="tile">G</div>
    <div class="tile accent">R</div>
    <div class="tile">A</div>
    <div class="tile">M</div>
  </div>
  <p>Solver &nbsp;·&nbsp; Unscramble any word</p>
</header>

<div class="card">
  <div class="field-label">
    Your letters
    <span class="hint-badge">space or ? = wildcard</span>
  </div>
  <input class="main-input" id="letters" type="text" placeholder="e.g.  RATES  ??" maxlength="24" autocomplete="off" spellcheck="false">

  <div class="wildcard-row">
    <p class="wildcard-note">
      Up to <strong>3</strong> wildcards — press <strong>space</strong> or type <strong>?</strong>
    </p>
    <div class="wc-dots">
      <div class="wc-dot" id="wc0"></div>
      <div class="wc-dot" id="wc1"></div>
      <div class="wc-dot" id="wc2"></div>
    </div>
  </div>

  <label class="advanced-toggle">
    <input type="checkbox" id="adv-toggle">
    <span class="toggle-track"></span>
    <span class="toggle-label">Advanced options</span>
  </label>

  <div class="advanced-panel" id="adv-panel">
    <div class="adv-grid">
      <div class="adv-field">
        <div class="field-label">Starts with</div>
        <input class="adv-input" type="text" id="starts" placeholder="e.g. pre" maxlength="10" autocomplete="off" spellcheck="false">
      </div>
      <div class="adv-field">
        <div class="field-label">Ends with</div>
        <input class="adv-input" type="text" id="ends" placeholder="e.g. ing" maxlength="10" autocomplete="off" spellcheck="false">
      </div>
      <div class="adv-field full">
        <div class="field-label">Exclude letters</div>
        <input class="adv-input" type="text" id="exclude" placeholder="letters that must not appear in results" maxlength="26" autocomplete="off" spellcheck="false">
      </div>
    </div>
  </div>

  <hr class="divider">
  <button class="solve-btn" id="solve-btn">Find Words</button>
</div>

<div id="results-wrap"></div>

<footer class="disclaimer">
  <strong>⚡ Vibecoded</strong> &nbsp;—&nbsp; This tool was built with vibes and AI assistance.
  Word results may be incomplete or incorrect. Use at your own risk.
  Not responsible for Scrabble disputes, crossword catastrophes, or general wordplay mayhem.
</footer>

<script>
// ── Theme ─────────────────────────────────────────────────────────────────────
function toggleTheme() {
  const html = document.documentElement;
  const going_dark = html.getAttribute('data-theme') === 'light';
  html.setAttribute('data-theme', going_dark ? 'dark' : 'light');
  document.getElementById('theme-icon').textContent = going_dark ? '☀' : '☽';
  document.getElementById('theme-label').textContent = going_dark ? 'Light mode' : 'Dark mode';
}

// Auto-detect system preference
if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
  document.documentElement.setAttribute('data-theme', 'dark');
  document.getElementById('theme-icon').textContent = '☀';
  document.getElementById('theme-label').textContent = 'Light mode';
}

// ── Word list ─────────────────────────────────────────────────────────────────
let WORDS = null;

async function loadWords() {
  const W = `ab ace aces ache ached aches acid acids act acts add adds age aged ages ago aid aids aim aims air aired airs ale ales all aloe aloes also alter alters am amp amps an and ant ante anted ants any ape aped apes apt arc arcs are area areas arm armed arms art arts ask asks ate awe awed awes axe axes bad bade bag bags ban band bands bane banes bare bared bares bark barks barn barns bars base based bat bate bated bates bats bay bays beam beams bean beans bear bears beat beats bed beds bee beef beer bees best bet bets bid bide bides bids bike biked bikes bill bills bit bite bites bits blade blades blare blared blares blast blasts blot blots blow blows blue blued blues blur blurs boat boats boil boils bold bolt bolts bone boned bones bore bored bores born boy boys braid braids brain brains brake brakes bran brans brave braved braves brawl brawls brew brews brim brims brine brines brisk brow brows bud buds bug bugs bull bun buns burn burns but buy buys buyer buyers bye byes cab cabs cage caged cages cake cakes calm calms came cane caned canes cap cape capes caps car card cards care cared cares cars cart carts case cased cases cast casts cat cats cave caved caves cent cents chain chains chair chairs chalk chalks chance chanced chances charm charms chart charts chase chased cob cobs cod code coded codes cog cogs coil coils coin coined coins coke come comes cop cope coped copes cops core cored cores corn corns cost cot cots cram crams crane craned cranes creak creaks crest crests crop crops crow crows cub cube cubed cubes cubs cup cups cure cured cures curl curls cut cute cuts dab dabs dale dales dam dame dames damp damps dams dare dared dares dark darn darns dart darts date dated dates deal deals dean deans dear dears debt debts den dens desk desks die dies dim dime dimes dims dip dips dire disk disks dive dived dives dog dogs dome domes done dote doted dotes dove doves draw draws drew drill drills drip drips drive drives drone drones drop drops drove dug dune dunes dupe duped dupes ear earn earns ears ease eased east eater eaters edge edged edges elm elms emu emus end ends era eras even evens ever evil evils ewe ewes face faced faces fact facts fade faded fades fake faked fakes fame famed far fare fared fares farm farms fast fats fear fears feast feel feels fell fern ferns fill fills film films fine fined fines fir fire fired fires firs fit fits flame flames flare flared flares flat flats flaw flaws flea fleas fled fly foam fogs fold folds fond fore form forms fort forts frame framed frames free freed frees fret frets frog frogs fuel fuels full fume fumed fumes fun fur gain gains gale gales game gamed games gap gaps gate gated gates gave gaze gazed gazes gear gears gin glad glade glades glare glared glares glean gleans glide glides gnat gnats goat goats gore gores grain grams grape grapes grasp grasps grate grated grates gray grays graze grazed green greens grew grid grids grime grimed grimes grind grinds groan groans grope groped gropes grove groves grow growl growls grown grows guard guards gulp gulps gust had hale half halt halts ham hand hands hang hangs hard hare hared hares harm harms hate hated hater haters hates haul hauls have hay head heads heal heals heap heaps heat heats heel heels helm helms herd herds hip hips hire hired hires hit hits hive hived hives hold holds hole holed holes home homed homes hood hoods hop hope hoped hopes hops horn horns hot hour hours hub hubs hue hues hum hump humps hums hurl hurls ice iced ices idle idled idles imp imps ink inks inn inns ion ions irk irks iron irons isle isles jab jabs jar jars jam jams jolt jolts lab labs lace laced laces lack lacks lake lakes lame lamed lames lamp lamps land lands lane lanes lard lark larks lash last late laze lazed lazes lead leads lean leans leap leaps learn learns left lend lends let lets lie lied lies list live lived lives lob lobe lobes lobs lock locks loft lore lose loss lot lots love loved loves lull lulls lump lumps lunge lunged lunges lure lured lures lurk lurks made mail mails man mane manes many map maps mare mares mark marks mast mat mate mated mates maze mazed mazes mead meal meals mean means meat meats meet mend mends mesh mild mile miles mind mist mob mode mole moles molt molts mop mope moped mopes mops mud mug mugs mule mules mull mulls nail nails name named names nap naps nave naves near nears neck necks need needs newt newts nit nits node nodes nose nosed note noted notes oak oaks oar oars oil oils omen omens one oral orb orbs ore ores own page pages pal pale paled pales pals pan pane panes pang pangs par pare pared pares park parks part parts paste pat path paths pave paved paves pay pays peal peals pear pears peat pen pens pine pined pines pins pit pits plan plane planed planes plate plated plates play plays plead pleads plow plows plum plus plunk plunks pole poles pose pored pores press prey preys probe probed probes prop props prove proved row pun put puts race raced racer races rack racks raft rafts rail rails rain rams rang range ranged ranges rank ranks rap rate rated rates rave raved raves raw ray rays read reads real realm realms rear reap reaps red reds reef reels rend rends rent rents rest rib ribs rid ride rider rides rig rigs ring rings rink rinks rip rips rise risk road roads roam roar roars rob robe robes rods role roles rope roped ropes rose rot rote rots row rows rub rubs rude rue ruin ruins rule ruled rules run rung rungs runs rust rut ruts sad safe sage sail sails sake sale sales salt sand sane sang sap saps sat save saved saves sea seal seals seam sear sears seat seats set sets share shared shark sharks shed ship ships shoe shoes shop shops shot show shows site sites size sized sizes skin skins skip skips slat slate slated slates slave slaved slaves slay slays slim slime slimed slimes slip slips slob slope sloped slopes slot slow snag snap snob sole soled soles song sort soul some soup sour span spare spared spares spark spear spears spell spells spend spends spine spined spines spit spot strap straps stray strays stride strip stripe strips stub style swam swirl tack tacks tail tails take taken taker takers tale tales tame tamed tang tangs tank tanks tap tape taped tapes taps tarn tarns tarp tarps task tasks tea teal tell tells ten tend tends test tests tide tided tides tier tiers time timed timer timers times tin tins tire tired tires toad toads toil toils told tome tones ton tone tons top tops tore torn tow town towns trace traced traces track tracks trade traded trades trail trails train trains tram trap traps tray trays tree trees trend trends trim trims trip trips trod tune tuned tunes turn turns tusk twin twins vane vaned vanes vat vats veil veils vein veins verb verbs vest vets vial vials vine vines void wade waded wades wage waged wages wane waned wanes war ward wards ware wares warm warms warp warps wart warts wash waste wasted wave waved waves way ways wed weld welds well wells went west wide wild win wine wined wines wire wired wires wise worn write rile riles rime rimed rimes route routed routes roved roves send sent shirt slab slid slim slur smear snare snub stir stop stun trek true turf vast vale wale weld wide wrap able aged aide aloft amble ample angle ankle apart apex arson atone avid axle bale barn basis battle bead beset blaze boon booth bread bribe bride brief brood broth brown bunch cable cabin camel canoe catch cedar chafe champ child claim clamp cling cloak clone clue coat comet conk coral creed creep crimp crisp cycle daisy dawn decay decal decoy defer delta dense depth derby devil dingy disco ditch dodge donkey drape drawn drool drums duels dumps dunce dusty dwarf eager eagle early earth emote empty endow enter envoy erode event exact exert extra fable fairy falter fancy fatal fence fetch fiber flair flank flesh flint floss flute foal focal folio foray force forge found frank fresh frill frost frown frugal fungi gable gamble girth given gland gleam globe gloat glory gloss glove grace grade grant grasp graze greed greet grill grope gross grout gruff guise habit hamper haven hedge heist holly honey honor hound humid hustle image infer ingot input inter inure issue ivory jelly jewel joust juice jumpy label later latch lathe latex layer leafy leapt legal lemon lever libel linen liner lingo lodge logic lunar lusty magic maple medal medic melee metal minor mirth model moist moldy moral moose motto mulch mural naive navel nerve newly nomad nymph offer often onion otter outfit outer papal parry pasta patch pause payee pearl pedal petal phase phony photo piano pilot place plait plant pleat plumb plume poise poker polka porch pouty power preen prime probe prone proxy psalm punch quaff qualm quart quasi queen query quest quill quirk quota quote radar raven rayon reach rebel reign relic renew repay repel repent reply rerun reuse rigid ripen rival rivet roast robot rocky roman rondo roost royal rural safer saint sandy sauce scalp scant scarf scent scope score scout screw scrub sedan seize sense serve seven shaft shame shear sheen shelf shell shift shine shock skirt skull slack slant sleet slew sliver smoke smock snarl sneak snide soften sonic suave tacit taffy tardy taunt tempo tenor tepid terse testy theft theme thick thief thigh thorn threw tiara tidal tiger timid tipsy title toady today token topaz torch total touch tough trait treble tremble trench trial trick trill trust tuber tulip tunic tutor twice twirl ultra uncle upset usual vague valor value valve vigil visual visor vogue voter vowed vowel wacky wager waltz weary weave wedge weedy welts windy witty woken wrath wring wrote yacht young youth zero zone zones zeal stare stared stares stark start state stone store stored stores storm stove stark stand star stars stark tales star stale stales stall stalls stale stales stack stacks stand stands`;
  return [...new Set(W.split(/\s+/).filter(w => w.length >= 2))];
}

// ── Core solver ───────────────────────────────────────────────────────────────

/**
 * Check if `word` (uppercase) can be spelled using `letterPool` (array of uppercase chars)
 * plus up to `wildcardsLeft` wildcards.
 *
 * This checks the WHOLE word against the WHOLE available pool.
 * starts/ends filters are applied separately; they don't subtract from the pool.
 */
function canForm(word, letterPool, wildcardsLeft) {
  const pool = [...letterPool];
  let wilds = wildcardsLeft;
  for (const ch of word) {
    const idx = pool.indexOf(ch);
    if (idx !== -1) {
      pool.splice(idx, 1);
    } else if (wilds > 0) {
      wilds--;
    } else {
      return false;
    }
  }
  return true;
}

async function solve() {
  const raw = document.getElementById('letters').value.toUpperCase();
  const starts = document.getElementById('starts').value.trim().toUpperCase().replace(/[^A-Z]/g, '');
  const ends   = document.getElementById('ends').value.trim().toUpperCase().replace(/[^A-Z]/g, '');
  const exclude = document.getElementById('exclude').value.toUpperCase().split('').filter(c => /[A-Z]/.test(c));

  const cleanRaw = raw.replace(/\s/g, '?');
  if (!cleanRaw.replace(/\?/g, '')) {
    document.getElementById('results-wrap').innerHTML = '';
    return;
  }

  const wildcards = (cleanRaw.match(/\?/g) || []).length;
  if (wildcards > 3) { showError('Maximum 3 wildcards allowed.'); return; }

  // The starts/ends letters are PART of the word, so they count as available tiles.
  // e.g. "??U" + ends "ER" means the tile pool is [?,?,U,E,R] — 5 tiles total.
  const inputLetters = cleanRaw.split('').filter(c => /[A-Z]/.test(c));
  const fullPool = [...inputLetters, ...starts.split(''), ...ends.split('')];
  const totalAvailable = fullPool.length + wildcards;

  const wrap = document.getElementById('results-wrap');
  wrap.innerHTML = `<div class="loading"><div class="spinner"></div> Searching…</div>`;

  if (!WORDS) WORDS = await loadWords();

  const results = [];

  for (const word of WORDS) {
    const w = word.toUpperCase();
    if (w.length < 2 || w.length > totalAvailable) continue;
    if (starts && !w.startsWith(starts)) continue;
    if (ends && !w.endsWith(ends)) continue;
    if (exclude.some(c => w.includes(c))) continue;
    if (canForm(w, fullPool, wildcards)) results.push(w);
  }

  results.sort((a, b) => b.length - a.length || a.localeCompare(b));
  renderResults([...new Set(results)]);
}

function renderResults(words) {
  const wrap = document.getElementById('results-wrap');
  if (!words.length) {
    wrap.innerHTML = `<div class="no-results">No words found — try more wildcards or relax the filters.</div>`;
    return;
  }

  const groups = {};
  for (const w of words) {
    if (!groups[w.length]) groups[w.length] = [];
    groups[w.length].push(w);
  }
  const lengths = Object.keys(groups).map(Number).sort((a,b) => b-a);

  let html = `<div class="results-header">
    <span class="results-title">Results</span>
    <span class="results-count">${words.length} word${words.length !== 1 ? 's' : ''}</span>
  </div>`;

  let delay = 0;
  for (const len of lengths) {
    html += `<div class="length-group"><div class="length-label">${len} letters</div><div class="chips-row">`;
    for (const w of groups[len]) {
      html += `<div class="word-chip" style="animation-delay:${delay}ms">${w}</div>`;
      delay = Math.min(delay + 12, 260);
    }
    html += `</div></div>`;
  }
  wrap.innerHTML = html;
}

function showError(msg) {
  document.getElementById('results-wrap').innerHTML = `<div class="error-msg">${msg}</div>`;
}

// ── Wildcard dot indicator ────────────────────────────────────────────────────
function updateWcDots(count) {
  for (let i = 0; i < 3; i++) {
    document.getElementById('wc' + i).classList.toggle('used', i < count);
  }
}

// ── Main input: space → ?, uppercase, enforce max 3 wildcards ─────────────────
const lettersInput = document.getElementById('letters');

lettersInput.addEventListener('keydown', function(e) {
  if (e.key === ' ') {
    e.preventDefault();
    const currentWilds = (this.value.match(/\?/g) || []).length;
    if (currentWilds >= 3) return;
    const pos = this.selectionStart;
    this.value = this.value.slice(0, pos) + '?' + this.value.slice(this.selectionEnd);
    this.setSelectionRange(pos + 1, pos + 1);
    updateWcDots(currentWilds + 1);
    return;
  }
});

lettersInput.addEventListener('input', function() {
  const pos = this.selectionStart;
  let val = this.value.toUpperCase().replace(/ /g, '?');
  // Enforce max 3 wildcards by trimming excess from wherever they appear
  let wildCount = 0;
  val = val.split('').map(c => {
    if (c === '?') {
      if (wildCount < 3) { wildCount++; return '?'; }
      return ''; // drop excess
    }
    return c;
  }).join('');
  this.value = val;
  this.setSelectionRange(Math.min(pos, val.length), Math.min(pos, val.length));
  updateWcDots((val.match(/\?/g) || []).length);
});

// Advanced fields uppercase
['starts','ends','exclude'].forEach(id => {
  document.getElementById(id).addEventListener('input', function() {
    const pos = this.selectionStart;
    this.value = this.value.toUpperCase();
    this.setSelectionRange(pos, pos);
  });
});

document.getElementById('adv-toggle').addEventListener('change', function() {
  document.getElementById('adv-panel').classList.toggle('open', this.checked);
});

['letters','starts','ends','exclude'].forEach(id => {
  document.getElementById(id).addEventListener('keydown', e => {
    if (e.key === 'Enter') solve();
  });
});

document.getElementById('solve-btn').addEventListener('click', solve);
</script>

</body>
</html>